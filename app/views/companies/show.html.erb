<!-- Page Container with subtle background -->
<div class="bg-slate-50/50 min-h-screen">
  <div class="max-w-4xl mx-auto px-6 py-7">
    
    <!-- Back Navigation -->
    <div class="flex items-center gap-3 mb-7">
      <%= link_to root_path, class: "flex items-center gap-3 text-slate-600 hover:text-slate-800 text-sm" do %>
        <svg class="w-3.5 h-3.5" viewBox="0 0 14 14" fill="none">
          <path d="M10.5 11L7 7.5L10.5 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <span class="font-medium">Back to Search</span>
      <% end %>
    </div>

    <!-- Company Header Card -->
    <div class="bg-white/80 backdrop-blur-sm rounded-xl shadow-sm border border-slate-200/60 mb-7">
      <div class="p-6">
        <!-- Header Section -->
        <div class="flex items-center justify-between mb-6">
          <div class="flex items-center gap-4">
            <!-- Company Icon -->
            <div class="bg-slate-100 p-2 rounded-lg">
              <svg class="w-5 h-5 text-slate-600" viewBox="0 0 21 21" fill="none">
                <path d="M8.25 9V12.75M12.75 9V12.75M6 21H15C15.7956 21 16.5587 20.6839 17.1213 20.1213C17.6839 19.5587 18 18.7956 18 18V6C18 5.20435 17.6839 4.44129 17.1213 3.87868C16.5587 3.31607 15.7956 3 15 3H9L6 6V18C6 18.7956 6.31607 19.5587 6.87868 20.1213C7.44129 20.6839 8.20435 21 9 21H6Z" stroke="currentColor" stroke-width="1.5"/>
              </svg>
            </div>
            
            <!-- Company Info -->
            <div>
              <h1 class="text-xl font-semibold text-slate-900 tracking-tight">
                <%= @company.company_name %>
              </h1>
              <p class="text-sm text-slate-500 mt-1">Software Development Company</p>
            </div>
          </div>
          
          <!-- Data Source Badge -->
          <div class="<%= @company.using_mock_data? ? 'bg-yellow-50 text-yellow-700 border-yellow-200' : 'bg-emerald-50 text-emerald-700 border-emerald-200' %> px-3 py-1.5 rounded-lg border text-xs font-medium flex items-center gap-2">
            <div class="w-2 h-2 bg-current rounded-full"></div>
            <%= @company.data_source_info %>
          </div>
        </div>

        <!-- Three Column Layout -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-7">
          
          <!-- Company Details Column -->
          <div class="space-y-4">
            <h3 class="text-xs font-semibold text-slate-700 uppercase tracking-wider mb-4">Company Details</h3>
            
            <div class="space-y-3.5">
              <div class="flex items-center justify-between">
                <span class="text-sm text-slate-500">CUI</span>
                <span class="text-sm font-medium text-slate-900"><%= @company.cui.gsub(/^RO/, '') %></span>
              </div>
              
              <div class="flex items-center justify-between">
                <span class="text-sm text-slate-500">Fiscal Activity</span>
                <div class="<%= @company.api_response['FiscalActivity'] == 'Active' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' : 'bg-yellow-50 text-yellow-700 border-yellow-200' %> px-2 py-1 rounded-lg border text-xs font-medium">
                  <%= @company.api_response['FiscalActivity'] %>
                </div>
              </div>
              
              <div class="flex items-center justify-between">
                <span class="text-sm text-slate-500">Legal Form</span>
                <span class="text-sm font-medium text-slate-900"><%= @company.api_response['LegalForm'] %></span>
              </div>
              
              <div class="flex items-center justify-between">
                <span class="text-sm text-slate-500">NACE Code</span>
                <span class="text-sm font-medium text-slate-900"><%= @company.api_response['NACE'] %></span>
              </div>
              
              <div class="flex items-center justify-between">
                <span class="text-sm text-slate-500">Registration</span>
                <span class="text-sm font-medium text-slate-900"><%= Date.parse(@company.api_response['Date']).strftime('%b %d, %Y') rescue @company.api_response['Date'] %></span>
              </div>
            </div>
          </div>

          <!-- Location Column -->
          <div class="space-y-4">
            <h3 class="text-xs font-semibold text-slate-700 uppercase tracking-wider mb-4">Location</h3>
            
            <div class="space-y-3.5">
              <div class="flex items-center justify-between">
                <span class="text-sm text-slate-500">City</span>
                <span class="text-sm font-medium text-slate-900"><%= @company.api_response['City'] %></span>
              </div>
              
              <div class="flex items-center justify-between">
                <span class="text-sm text-slate-500">County</span>
                <span class="text-sm font-medium text-slate-900"><%= @company.api_response['County'] %></span>
              </div>
              
              <div class="pt-1">
                <div class="text-sm text-slate-500 mb-1">Address</div>
                <div class="text-sm font-medium text-slate-900 leading-relaxed">
                  <%= @company.api_response['Address']&.split(',')&.join('<br>')&.html_safe || @company.api_response['Address'] %>
                </div>
              </div>
            </div>
          </div>

          <!-- Financial Overview Column -->
          <div class="space-y-4">
            <h3 class="text-xs font-semibold text-slate-700 uppercase tracking-wider mb-4">Financial Overview</h3>
            
            <div class="space-y-3.5">
              <div class="flex items-center justify-between">
                <span class="text-sm text-slate-500">Employees</span>
                <div class="bg-blue-50 text-blue-700 border-blue-200 px-2 py-1 rounded-lg border text-xs font-medium">
                  <%= @company.api_response['Employees'] %> employees
                </div>
              </div>
              
              <div class="flex items-center justify-between">
                <span class="text-sm text-slate-500">Turnover</span>
                <span class="text-sm font-semibold text-slate-900">â‚¬<%= number_with_delimiter(@company.api_response['Turnover']) %></span>
              </div>
              
              <div class="flex items-center justify-between">
                <span class="text-sm text-slate-500">Profit</span>
                <span class="text-sm font-semibold text-emerald-700">â‚¬<%= number_with_delimiter(@company.api_response['Profit']) %></span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Eligible Programs Section -->
    <% if @eligible_programs.any? %>
      <div class="mb-8">
        <!-- Section Header -->
        <div class="flex items-center gap-4 mb-6">
          <svg class="w-5 h-5 text-emerald-600" viewBox="0 0 21 21" fill="none">
            <path d="M9 12L11 14L15 10M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="1.5"/>
          </svg>
          <h2 class="text-lg font-semibold text-emerald-700">Eligible Programs</h2>
          <div class="bg-emerald-50 text-emerald-700 border-emerald-200 px-2 py-1 rounded-lg border text-xs font-medium">
            <%= @eligible_programs.count %> programs
          </div>
        </div>

        <!-- Programs Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
          <% @eligible_programs.each do |item| %>
            <% program = item[:program] %>
            <% check = item[:check] %>
            
            <div class="bg-white rounded-xl shadow-sm border border-slate-200/60">
              <div class="p-6">
                <!-- Program Header -->
                <div class="flex items-center gap-2 mb-2">
                  <div class="w-1 h-7 bg-emerald-500 rounded-full"></div>
                  <h3 class="text-sm font-semibold text-slate-900"><%= program.title %></h3>
                </div>
                
                <!-- Program Description -->
                <div class="text-sm text-slate-600 leading-relaxed mb-5">
                  <%= truncate(program.description, length: 150) %>
                </div>
              </div>
              
              <!-- AI Analysis Section -->
              <div class="px-6 pb-5">
                <div class="bg-emerald-50 border border-emerald-200 rounded-lg p-3 mb-4">
                  <div class="flex items-center justify-between mb-2">
                    <div class="flex items-center gap-2">
                      <span class="text-sm text-slate-600">ðŸ¤– AI Analysis:</span>
                      <div class="bg-emerald-100 text-emerald-700 border-emerald-300 px-2 py-0.5 rounded-lg border text-xs font-medium">
                        âœ“ ELIGIBLE
                      </div>
                    </div>
                    
                    <!-- Scoring Badges -->
                    <div class="flex items-center gap-2">
                      <div class="bg-emerald-100 text-emerald-700 border-emerald-300 px-2 py-0.5 rounded-lg border text-xs font-medium">7</div>
                      <div class="bg-yellow-100 text-yellow-700 border-yellow-300 px-2 py-0.5 rounded-lg border text-xs font-medium">4</div>
                    </div>
                  </div>
                  
                  <div class="text-sm text-blue-600 hover:text-blue-800 cursor-pointer">
                    View detailed AI analysis
                  </div>
                </div>
                
                <!-- Action Buttons -->
                <div class="flex items-center gap-2 pt-3.5">
                  <%= link_to funding_program_path(program), 
                             class: "bg-white border border-slate-300 text-slate-900 px-3 py-1.5 rounded-lg text-xs font-medium hover:bg-slate-50 flex items-center gap-2" do %>
                    <svg class="w-3.5 h-3.5" viewBox="0 0 14 14" fill="none">
                      <path d="M7 2.5V7H10.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                      <circle cx="7" cy="7" r="4.5" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    Details
                  <% end %>
                  
                  <%= link_to chat_funding_program_path(program, company_id: @company.id), 
                             class: "bg-blue-600 text-white px-3 py-1.5 rounded-lg text-xs font-medium hover:bg-blue-700 flex items-center gap-2" do %>
                    <svg class="w-3.5 h-3.5" viewBox="0 0 14 14" fill="none">
                      <path d="M4.5 5.5H9.5M4.5 8H7.5M2 11.5L3.5 10H11C11.2761 10 11.5 9.77614 11.5 9.5V3.5C11.5 3.22386 11.2761 3 11 3H3C2.72386 3 2.5 3.22386 2.5 3.5V10.5C2.5 11.0523 2.05228 11.5 1.5 11.5H2Z" stroke="currentColor" stroke-width="1.5"/>
                    </svg>
                    Chat with AI
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>

    <!-- Ineligible Programs Section -->
    <% if @ineligible_programs.any? %>
      <div class="mb-8">
        <!-- Section Header -->
        <div class="flex items-center gap-4 mb-4">
          <svg class="w-5 h-5 text-slate-500" viewBox="0 0 21 21" fill="none">
            <path d="M12 9V13M12 17H12.01M21 12C21 16.9706 16.9706 21 12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12Z" stroke="currentColor" stroke-width="1.5"/>
          </svg>
          <h2 class="text-lg font-semibold text-slate-600">Ineligible Programs</h2>
          <div class="bg-slate-100 text-slate-600 border-slate-200 px-2 py-1 rounded-lg border text-xs font-medium">
            <%= @ineligible_programs.count %> programs
          </div>
        </div>

        <!-- Collapsible Section -->
        <div class="bg-white rounded-xl shadow-sm border border-slate-200/60">
          <div class="px-4 py-5">
            <div class="flex items-center justify-between cursor-pointer" onclick="toggleIneligible()">
              <span class="text-sm font-medium text-slate-700">View ineligible programs and reasons</span>
              <svg id="ineligible-arrow" class="w-3.5 h-3.5 text-slate-400 transition-transform" viewBox="0 0 14 14" fill="none">
                <path d="M4 5.5L7 8.5L10 5.5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </div>
            
            <div id="ineligible-content" class="hidden mt-4 space-y-4">
              <% @ineligible_programs.each do |item| %>
                <% program = item[:program] %>
                <% check = item[:check] %>
                
                <div class="bg-slate-50 rounded-lg p-4 border border-slate-200">
                  <div class="flex items-start gap-2 mb-2">
                    <div class="w-1 h-6 bg-slate-400 rounded-full"></div>
                    <div>
                      <h4 class="text-sm font-semibold text-slate-900"><%= program.title %></h4>
                      <p class="text-xs text-slate-600 mt-1"><%= truncate(program.description, length: 100) %></p>
                    </div>
                  </div>
                  
                  <div class="bg-red-50 border border-red-200 rounded-lg p-3 mt-3">
                    <div class="flex items-center gap-2 mb-1">
                      <span class="text-xs text-slate-600">ðŸ¤– AI Analysis:</span>
                      <div class="bg-red-100 text-red-700 border-red-300 px-2 py-0.5 rounded-lg border text-xs font-medium">
                        âœ— NOT ELIGIBLE
                      </div>
                    </div>
                    <p class="text-xs text-slate-600 leading-relaxed"><%= check.ai_response %></p>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    <% end %>

  </div>
</div>

<script>
function toggleIneligible() {
  const content = document.getElementById('ineligible-content');
  const arrow = document.getElementById('ineligible-arrow');
  
  if (content.classList.contains('hidden')) {
    content.classList.remove('hidden');
    arrow.style.transform = 'rotate(180deg)';
  } else {
    content.classList.add('hidden');
    arrow.style.transform = 'rotate(0deg)';
  }
}
</script>