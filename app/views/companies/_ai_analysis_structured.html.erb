<% data = parse_ai_analysis(check.ai_response) %>

<!-- Compact Category Lists -->
<div class="space-y-1">
  <!-- REFUZATE Section -->
  <% if data[:refuzate].any? %>
    <div class="mb-2">
      <div class="text-xs font-medium text-error mb-1">❌ Criterii blocante (<%= data[:refuzate].size %>)</div>
      <ul class="list-disc list-inside space-y-1 text-xs leading-snug">
        <% data[:refuzate].each do |item| %>
          <li><span class="font-medium"><%= item[:criterion] %></span><%=
            item[:explanation].present? ? content_tag(:span, ": #{item[:explanation]}", class: "text-base-content/70") : ""
          %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- NEVALIDATE Section -->
  <% if data[:nevalidate].any? %>
    <div class="mb-2">
      <div class="text-xs font-medium text-warning mb-1">⚠️ Informații lipsă (<%= data[:nevalidate].size %>)</div>
      <ul class="list-disc list-inside space-y-1 text-xs leading-snug">
        <% data[:nevalidate].each do |item| %>
          <li><span class="font-medium"><%= item[:criterion] %></span><%=
            item[:explanation].present? ? content_tag(:span, ": #{item[:explanation]}", class: "text-base-content/70") : ""
          %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <!-- ACCEPTATE Section -->
  <% if data[:acceptate].any? %>
    <div class="collapse collapse-arrow">
      <input type="checkbox" />
      <div class="collapse-title text-xs py-1 min-h-0">
        <span class="font-medium text-success">✅ Criterii îndeplinite (<%= data[:acceptate].size %>)</span>
      </div>
      <div class="collapse-content pt-0">
        <ul class="list-disc list-inside space-y-1 text-xs leading-snug">
          <% data[:acceptate].each do |item| %>
            <li><span class="font-medium"><%= item[:criterion] %></span><%=
              item[:explanation].present? ? content_tag(:span, ": #{item[:explanation]}", class: "text-base-content/70") : ""
            %></li>
          <% end %>
        </ul>
      </div>
    </div>
  <% end %>
</div>

<!-- Simple Next Steps (only if needed) -->
<% if data[:refuzate].any? || data[:nevalidate].any? %>
  <div class="mt-2 p-2 bg-base-200 rounded text-xs leading-snug">
    <div class="font-medium mb-1">💡 Pași următori</div>
    <% if data[:refuzate].any? %><div>• Revizuiește criteriile blocante</div><% end %>
    <% if data[:nevalidate].any? %><div>• Completează informațiile lipsă</div><% end %>
  </div>
<% end %>

<!-- Raw AI Reasoning (Collapsed) -->
<div class="collapse collapse-arrow mt-2">
  <input type="checkbox" />
  <div class="collapse-title text-xs py-1 min-h-0">
    <span>🔍 Raționament AI complet</span>
  </div>
  <div class="collapse-content pt-0">
    <div class="text-xs text-base-content/70 whitespace-pre-wrap leading-tight"><%= data[:raw_text] %></div>
  </div>
</div>
