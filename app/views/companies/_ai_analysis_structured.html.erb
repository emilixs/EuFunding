<% data = parse_ai_analysis(check.ai_response) %>
<% status_info = eligibility_status_info(data[:result]) %>

<!-- Compact Status & Stats -->
<div class="flex flex-col sm:flex-row gap-3 mb-4">
  <!-- Status -->
  <div class="alert <%= status_info[:class] %> py-2 px-3 flex-1">
    <span><%= status_info[:icon] %></span>
    <span class="font-semibold"><%= status_info[:text] %></span>
  </div>

  <!-- Quick Stats -->
  <div class="flex gap-2">
    <div class="badge badge-success gap-1 py-3 px-3">
      <span>✓</span>
      <span><%= data[:acceptate].size %></span>
    </div>
    <div class="badge badge-error gap-1 py-3 px-3">
      <span>✗</span>
      <span><%= data[:refuzate].size %></span>
    </div>
    <div class="badge badge-warning gap-1 py-3 px-3">
      <span>?</span>
      <span><%= data[:nevalidate].size %></span>
    </div>
  </div>
</div>

<!-- Compact Category Lists -->
<div class="space-y-2">
  <!-- REFUZATE Section -->
  <% if data[:refuzate].any? %>
    <div class="collapse collapse-arrow bg-base-200">
      <input type="checkbox" checked />
      <div class="collapse-title text-sm py-2">
        <span class="badge badge-error gap-1">
          <span>✗</span>
          <span><%= data[:refuzate].size %></span>
        </span>
        <span class="ml-2 font-medium">Criterii blocante</span>
      </div>
      <div class="collapse-content pt-0">
        <% data[:refuzate].each do |item| %>
          <div class="flex gap-2 py-1 text-sm">
            <span class="text-error">•</span>
            <div>
              <span class="font-medium"><%= item[:criterion] %></span>
              <% if item[:explanation].present? %>
                <span class="text-base-content/70">: <%= item[:explanation] %></span>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- NEVALIDATE Section -->
  <% if data[:nevalidate].any? %>
    <div class="collapse collapse-arrow bg-base-200">
      <input type="checkbox" checked />
      <div class="collapse-title text-sm py-2">
        <span class="badge badge-warning gap-1">
          <span>?</span>
          <span><%= data[:nevalidate].size %></span>
        </span>
        <span class="ml-2 font-medium">Informații lipsă</span>
      </div>
      <div class="collapse-content pt-0">
        <% data[:nevalidate].each do |item| %>
          <div class="flex gap-2 py-1 text-sm">
            <span class="text-warning">•</span>
            <div>
              <span class="font-medium"><%= item[:criterion] %></span>
              <% if item[:explanation].present? %>
                <span class="text-base-content/70">: <%= item[:explanation] %></span>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <!-- ACCEPTATE Section -->
  <% if data[:acceptate].any? %>
    <div class="collapse collapse-arrow bg-base-200">
      <input type="checkbox" />
      <div class="collapse-title text-sm py-2">
        <span class="badge badge-success gap-1">
          <span>✓</span>
          <span><%= data[:acceptate].size %></span>
        </span>
        <span class="ml-2 font-medium">Criterii îndeplinite</span>
      </div>
      <div class="collapse-content pt-0">
        <% data[:acceptate].each do |item| %>
          <div class="flex gap-2 py-1 text-sm">
            <span class="text-success">•</span>
            <div>
              <span class="font-medium"><%= item[:criterion] %></span>
              <% if item[:explanation].present? %>
                <span class="text-base-content/70">: <%= item[:explanation] %></span>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>
</div>

<!-- Simple Next Steps (only if needed) -->
<% if data[:refuzate].any? || data[:nevalidate].any? %>
  <div class="mt-3 p-3 bg-base-200 rounded text-sm">
    <div class="font-medium mb-1">💡 Pași următori:</div>
    <% if data[:refuzate].any? %>
      <div class="text-error">• Revizuiește criteriile blocante de mai sus</div>
    <% end %>
    <% if data[:nevalidate].any? %>
      <div class="text-warning">• Completează informațiile lipsă pentru o analiză precisă</div>
    <% end %>
  </div>
<% end %>

<!-- Raw AI Reasoning (Collapsed) -->
<div class="collapse collapse-arrow bg-base-200 mt-3">
  <input type="checkbox" />
  <div class="collapse-title text-xs py-2">
    <span>🔍</span>
    <span>Raționament AI complet</span>
  </div>
  <div class="collapse-content pt-0">
    <div class="text-xs text-base-content/70 whitespace-pre-wrap"><%= data[:raw_text] %></div>
  </div>
</div>
